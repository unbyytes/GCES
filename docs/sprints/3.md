# üìù Relat√≥rio de Contribui√ß√£o ‚Äì Sprint 2

**Disciplina:** Gest√£o de Configura√ß√£o e Evolu√ß√£o de Software

**Equipe:** OWASP (Times Blue e Red)

**Per√≠odo da Sprint:** 07/10/2025 - 22/10/2025

---

## 1. Objetivos da Sprint

#### Blue Team

**Sele√ß√£o do Arsenal de Seguran√ßa e In√≠cio da Implementa√ß√£o de DevSecOps**

* Realizar uma pesquisa comparativa de ferramentas de seguran√ßa *open-source* nas categorias: **Detec√ß√£o de Segredos, An√°lise Est√°tica (SAST), An√°lise de Depend√™ncias (SCA) e Infraestrutura como C√≥digo (IaC)**.
* Selecionar o "arsenal" de ferramentas ideal para o projeto EJ-Platform, justificando a escolha do conjunto com base em crit√©rios de complementaridade, performance e adequa√ß√£o ao projeto.
* Integrar a primeira ferramenta de seguran√ßa selecionada ao pipeline de CI/CD no GitLab, configurando um novo *job* e validando a sua execu√ß√£o autom√°tica a cada `push`.
* Documentar todo o processo de pesquisa e a decis√£o final em um relat√≥rio consolidado.
  
### Red Team

* Explorar Ataques:
    * IDOR
    * Sess√£o (Cookies)
    * Rate-limit / Fuzzing
* Simular phishing no contexto da plataforma

---

## 2. Entregas Coletivas

| Entrega                                                             | Status (Conclu√≠do/Parcial/Pendente) | Link/Refer√™ncia        | Observa√ß√µes                       |
| ------------------------------------------------------------------- | ----------------------------------- | ---------------------- | --------------------------------- |
| Simular Phishing no Contexto da EJ                                  | Conclu√≠do                           |                        |                                   |
| Estudo e Implementa√ß√£o de Ferramentas de Seguran√ßa no CI/CD         | Conclu√≠do                           |                        | Gitleaks e Bandit testados        |

---

## 3. Contribui√ß√µes Individuais

| Integrante        | Contribui√ß√µes                             | Links (PRs, Issues, Docs) | Observa√ß√µes |
| ----------------- | ----------------------------------------- | ------------------------- | ----------- |
| Miguel Arthur     | Documenta√ß√£o e Tabela Comparativa  | [()](link) |             |
| Daniel Rocha     | Documenta√ß√£o e Resultados Parciais da Utiliza√ß√£o do GitLeaks na pipeline do projeto, al√©m dos testes locais utilizando o gitleaks  | [Di√°rio Daniel](../diarios/190104821/sprint_3_diario.md) |   Os resultados podem ser vistos na aba **Exemplos pr√°ticos**          |
| Ana Carolina     | An√°lise de depend√™ncias com pip-audit | [Pipeline pip-audit](https://gitlab.com/caroll_mf/ej-application/-/commit/3f749028) | Pipeline focada em seguran√ßa de depend√™ncias |
| Mateus Vieira     | Abertura de Issue sobre XSS no EJ | [ej-application#1505](https://gitlab.com/pencillabs/ej/ej-application/-/issues/1505) |  |
| Sebasti√°n Zuzunaga     | An√°lise est√°tica com semgrep | [Pipeline semgrep](https://gitlab.com/sebazac332/ej-application-sebastian/-/pipelines/2114028625) |  |

---

## 4. Maiores Avan√ßos

### Blue Team

### Pesquisa e Sele√ß√£o do Arsenal de Seguran√ßa

Dando continuidade ao plano de implementa√ß√£o de um pipeline de DevSecOps, o objetivo desta sprint foi realizar uma pesquisa aprofundada para selecionar o conjunto ideal de ferramentas de seguran√ßa para o projeto EJ-Platform.

A metodologia consistiu em dividir a pesquisa em quatro categorias essenciais, visando criar uma estrat√©gia de **defesa em camadas**, onde cada ferramenta possui uma responsabilidade clara e complementar:

1.  **Detec√ß√£o de Segredos:** Prevenir o vazamento de credenciais e chaves de API.
2.  **An√°lise Est√°tica de Seguran√ßa (SAST):** Encontrar vulnerabilidades no c√≥digo-fonte da aplica√ß√£o.
3.  **An√°lise de Composi√ß√£o de Software (SCA):** Identificar vulnerabilidades em depend√™ncias de terceiros.
4.  **Seguran√ßa de Infraestrutura como C√≥digo (IaC):** Garantir que a configura√ß√£o dos nossos cont√™ineres (`Dockerfile`) segue as boas pr√°ticas de seguran√ßa.


### Ferramentas de Seguran√ßa Pesquisadas e Avaliadas

Nesta sprint, a equipe realizou uma pesquisa aprofundada e uma an√°lise comparativa de ferramentas *open-source* em quatro categorias distintas para compor um arsenal de seguran√ßa coeso. O objetivo foi avaliar as melhores op√ß√µes para cada camada de defesa do nosso pipeline de CI/CD.

* **Detec√ß√£o de Segredos (Secrets Detection)**
    * **Gitleaks:** Scanner r√°pido baseado em regras para encontrar credenciais e chaves de API expostas no c√≥digo.
    * **TruffleHog:** Ferramenta de an√°lise profunda que busca segredos com base em regras e na entropia dos dados.

* **An√°lise Est√°tica de Seguran√ßa (SAST)**
    * **Bandit:** Analisador focado em encontrar vulnerabilidades comuns e de baixo n√≠vel em c√≥digo Python.
    * **Semgrep:** Motor de an√°lise de c√≥digo moderno e flex√≠vel, com uma vasta base de regras para frameworks web como o Django, capaz de encontrar vulnerabilidades complexas.

* **An√°lise de Composi√ß√£o de Software (SCA)**
    * **pip-audit:** Ferramenta oficial do ecossistema Python que verifica depend√™ncias contra a base de dados de vulnerabilidades aberta (OSV).
    * **Safety:** Ferramenta tradicional que verifica depend√™ncias contra sua pr√≥pria base de dados de vulnerabilidades.

* **Seguran√ßa de Infraestrutura como C√≥digo (IaC)**
    * **Trivy:** Scanner multifuncional que analisa `Dockerfiles` em busca de m√°s pr√°ticas de seguran√ßa.
    * **Checkov:** Ferramenta especializada em IaC com uma cobertura extensiva de pol√≠ticas de seguran√ßa para diversas plataformas.


      A tabela a seguir consolida os resultados desta pesquisa, comparando as principais ferramentas open-source para cada categoria com base em sua funcionalidade, vantagens, desvantagens e, crucialmente, seu fator decisivo para a integra√ß√£o em nosso pipeline.

### Tabela Comparativa de Ferramentas de Seguran√ßa

| Categoria | Ferramenta | Breve Descri√ß√£o | Compara√ß√£o (Fator Decisivo) |
| :--- | :--- | :--- | :--- |
| **Detec√ß√£o de Segredos** | [Gitleaks](https://github.com/gitleaks/gitleaks) | Scanner r√°pido que busca segredos e credenciais em reposit√≥rios Git, utilizando uma base de regras de express√µes regulares. | **Melhor para CI/CD:** √â extremamente r√°pido e leve por ser um bin√°rio √∫nico (escrito em Go). Sua simplicidade o torna ideal para ser executado a cada `push` sem impactar a velocidade do pipeline. √â o padr√£o da ind√∫stria para preven√ß√£o r√°pida. |
| **Detec√ß√£o de Segredos** | [TruffleHog](https://github.com/trufflesecurity/trufflehog) | Scanner profundo que vai al√©m de regras, analisando a entropia dos dados para encontrar chaves com formatos desconhecidos. | **Melhor para Auditorias Profundas:** Sua capacidade de encontrar segredos com base na aleatoriedade (entropia) √© mais poderosa, mas o torna significativamente mais lento. √â uma ferramenta excelente para uma varredura completa e peri√≥dica, mas menos ideal para o pipeline do dia a dia. |
| **SAST** | [Bandit](https://github.com/PyCQA/bandit) | Ferramenta de SAST focada em encontrar problemas de seguran√ßa comuns em c√≥digo Python, analisando a √Årvore de Sintaxe Abstrata (AST). | **Melhor para Simplicidade em Python:** √â uma ferramenta "cl√°ssica", muito simples de rodar (`pip install` e executar). Seu foco exclusivo em Python garante uma boa detec√ß√£o de erros comuns no ecossistema (ex: uso de `pickle`, senhas fixas no c√≥digo). |
| **SAST** | [Semgrep](https://github.com/semgrep/semgrep) | Motor de an√°lise de c√≥digo moderno e multil√≠ngue com uma sintaxe de regras poderosa e intuitiva. | **Melhor em Poder e Flexibilidade:** √â a evolu√ß√£o do SAST. Suas regras s√£o mais f√°ceis de entender e customizar. A enorme base de regras da comunidade e a capacidade de se adaptar a qualquer padr√£o de c√≥digo o tornam mais poderoso e "√† prova de futuro" que o Bandit. |
| **SCA** | [pip-audit](https://github.com/pypa/pip-audit) | Ferramenta que escaneia as depend√™ncias do projeto em busca de vulnerabilidades, utilizando o banco de dados aberto e de alta qualidade OSV (Open Source Vulnerability). | **Melhor por usar um Padr√£o Aberto:** Sendo da PyPA (a mesma autoridade que cuida do `pip`), usa o banco de dados OSV, que √© um padr√£o da ind√∫stria mantido pelo Google. Isso garante dados de vulnerabilidade transparentes e de alta qualidade, sem restri√ß√µes comerciais. |
| **SCA** | [Safety](https://github.com/pyupio/safety) | Uma das ferramentas de SCA mais conhecidas para Python, que verifica as depend√™ncias instaladas contra seu pr√≥prio banco de dados de vulnerabilidades (Safety-DB). | **Modelo Comercial:** Sua principal desvantagem √© que a base de dados gratuita tem um atraso deliberado de 30 dias na divulga√ß√£o de novas vulnerabilidades, incentivando a assinatura da vers√£o paga. Para um projeto acad√™mico, o `pip-audit` √© uma escolha mais alinhada. |
| **IaC** | [Trivy](https://github.com/aquasecurity/trivy) | Scanner de vulnerabilidades multifuncional. Al√©m de imagens de cont√™ineres, ele tamb√©m consegue escanear arquivos de configura√ß√£o (como `Dockerfile` e `docker-compose.yml`) em busca de m√°s pr√°ticas. | **Melhor pela Consolida√ß√£o de Ferramentas:** A grande vantagem √© que poderemos usar a **mesma ferramenta** para escanear tanto a nossa IaC (Dockerfile) quanto as imagens Docker em uma sprint futura. Isso reduz a complexidade do pipeline e o n√∫mero de ferramentas para aprender. |
| **IaC** | [Checkov](https://github.com/bridgecrewio/checkov) | Ferramenta especializada em IaC que verifica arquivos de configura√ß√£o contra centenas de pol√≠ticas de seguran√ßa e boas pr√°ticas. | **Melhor em Cobertura Espec√≠fica para IaC:** √â mais poderoso e tem uma quantidade maior de regras *espec√≠ficas* para IaC do que o Trivy. √â a escolha de especialistas em nuvem, mas talvez seja um exagero para o nosso escopo, que se limita a Dockerfiles e Docker Compose. |

### Implementa√ß√£o do pip-audit - Seguran√ßa de Depend√™ncias


#### Como o pip-audit funciona

O pip-audit opera atrav√©s de um processo simples mas eficaz:
1. Coleta todas as depend√™ncias do projeto
2. Consulta o banco de dados OSV (Open Source Vulnerability) mantido pelo Google
3. Compara as vers√µes das depend√™ncias com vulnerabilidades conhecidas
4. Gera um relat√≥rio claro indicando quais pacotes necessitam de atualiza√ß√£o

#### Nossa Implementa√ß√£o no EJ-Platform

**Desafio t√©cnico:** O projeto EJ-Platform utiliza Poetry como gerenciador de depend√™ncias, enquanto o pip-audit tradicionalmente trabalha com arquivos requirements.txt. Foi necess√°rio desenvolver uma solu√ß√£o de integra√ß√£o entre os dois sistemas.

**Solu√ß√£o implementada:**
```yaml
dependency-audit:
  stage: security
  image: python:3.11-slim
  script:
    - pip install pip-audit
    - pip install "poetry==1.8.3"
    - poetry export -f requirements.txt --output requirements.txt --without-hashes
    - pip-audit -r requirements.txt --format=columns
  allow_failure: false
```


**Implementa√ß√£o Pr√°tica:**

(COLOCAR O QUE FOI IMPLEMENTADO NA PRATICA)

**Documenta√ß√£o Produzida:**

(REFERENCIAR OS DOCUMENTOS QUE FORAM PRODUZIDOS)

##### Exemplo de pipeline:

- C√≥digo usado na pipeline.

![Pipeline-gitleaks](../imgs/git-leaks-pipe-Daniel.png)

- Fluxo da pipeline.

![Fluxo](../imgs/fluxo-resultante-daniel.png)

-----

##### Fluxo resultante

![Resultado](../imgs/terminal-pipeline-resultado-daniel.png)

Como esperado, a pipeline se encerrou com erro, analisando 53 commits e identificando 52 leaks

- Job de (COLOCAR A FERRAMENTA QUE FOI IMPLEMENTADA).

![Job]()

![Job-detalhes]()

### Implementa√ß√£o do semgrep - An√°lise est√°tica de c√≥digo (SAST)

#### Como o semgrep funciona

1. Analisa o c√≥digo-fonte e gera uma √°rvore sint√°tica abstrata.
2. Aplica regras que definem padr√µes de c√≥digo suspeito.
3. Gera um relat√≥rio com os achados que podem ser exibidos no terminal, salvos em JSON, ou integrados ao pipeline CI/CD.

#### Nossa Implementa√ß√£o no EJ-Platform

**Solu√ß√£o implementada:**
```yaml
semgrep:
  stage: security
  image: semgrep/semgrep
  script: semgrep ci
  rules:
  - when: always
  variables:
    
    SEMGREP_APP_TOKEN: $SEMGREP_APP_TOKEN
    GITLAB_TOKEN: $PAT

  allow_failure: true
```
#### Resultado da pipeline

![Pipeline semgrep](../imgs/pipeline_semgrep_sebastian.PNG)

#### Resultado do Job

![Semgrep job](../imgs/semgrep_job_sebastian.PNG)

### Red Team

#### Issue sobre XSS

Durante a an√°lise do sistema **Empurrando Juntas**, foi identificada uma vulnerabilidade **Cross-Site Scripting (XSS)** do tipo **Persistente (Stored XSS)**.
A falha foi reportada oficialmente por meio de uma **issue p√∫blica** no GitLab:
üîó [Issue #1505 ‚Äî Empurrando Juntas](https://gitlab.com/pencillabs/ej/ej-application/-/issues/1505)

#### Contexto da Abertura

* Antes de abrir a issue, surgiu a d√∫vida sobre **a seguran√ßa de divulgar publicamente** uma vulnerabilidade.
* A quest√£o foi discutida:
    * No **canal oficial do Telegram** da comunidade EJ.
    * Diretamente com o **monitor Rodolfo**.
* Ambos confirmaram que **a abertura p√∫blica era adequada**.

#### Expectativa vs. Realidade

* A expectativa era existir um **canal mais reservado ou confidencial** para reportar falhas de seguran√ßa (ex.: formul√°rio interno, e-mail restrito ou programa de *responsible disclosure*).
* Contudo, essa op√ß√£o **n√£o estava dispon√≠vel**, sendo o **GitLab p√∫blico** o meio indicado para o registro da vulnerabilidade.

#### Decis√£o e Justificativa

* Mesmo com a divulga√ß√£o p√∫blica, n√£o houve desconforto significativo, pois:
    * O impacto da falha √© **alto** (possibilita execu√ß√£o de c√≥digo no navegador).
    * Mas o n√≠vel de explora√ß√£o √© **baixo** (exige usu√°rio autenticado com permiss√µes espec√≠ficas).

#### Conclus√£o

A issue foi aberta de forma transparente e respons√°vel, seguindo boas pr√°ticas de comunica√ß√£o com a comunidade. Essa experi√™ncia destacou a import√¢ncia de reportar falhas de seguran√ßa de forma √©tica, e tamb√©m a necessidade de que projetos open source ofere√ßam canais seguros e sigilosos para esse tipo de comunica√ß√£o.

---

#### Simula√ß√£o de Phishing

A plataforma "Empurrando Juntas" √© utilizada para facilitar a cria√ß√£o de conversas e vota√ß√µes em ambientes de opini√£o, permitindo a participa√ß√£o c√≠vica e democr√°tica. A an√°lise da infraestrutura de e-mail revelou as seguintes caracter√≠sticas para mensagens leg√≠timas:

| Campo | Valor Exemplo | An√°lise de Seguran√ßa |
| :--- | :--- | :--- |
| **from:** | Empurrando Juntas <cd@cidadedemocratica.org.br> via pencillabs.tec.br | Endere√ßo leg√≠timo aparente com retransmiss√£o por subdom√≠nio `pencillabs.tec.br`. |
| **to:** | X (Destinat√°rio) | - |
| **date:** | Oct 17, 2025, 10:21 AM | - |
| **subject:** | Please reset your password (Exemplo) | Assunto relevante ao contexto de uso. |
| **mailed-by:** | pencillabs.tec.br | Confirma o remetente leg√≠timo. |
| **signed-by:** | pencillabs.tec.br | Assinatura por DKIM/SPF leg√≠tima. |
| **security:** | Standard encryption (TLS) | Criptografia padr√£o durante o tr√¢nsito. |

**Objetivo da Simula√ß√£o:**

O objetivo desta simula√ß√£o √© avaliar a suscetibilidade dos usu√°rios da plataforma "Empurrando Juntas" a um ataque de *phishing* direcionado (*spear phishing*), utilizando como isca uma indica√ß√£o de fraude em conta, para roubo de credenciais (Nome de Usu√°rio e Senha).

**Detalhes da Simula√ß√£o de Phishing:**

**1. Prepara√ß√£o do E-mail Malicioso:**

O e-mail malicioso deve ser constru√≠do para replicar a apar√™ncia e os detalhes t√©cnicos de um e-mail leg√≠timo da plataforma, explorando a confian√ßa dos usu√°rios.

**Caracter√≠sticas do E-mail Falso:**

| Campo | Valor Simulador (Ataque) | Estrat√©gia de Engenharia Social |
| :--- | :--- | :--- |
| **from:** | `Empurrando Juntas <suporte@cidadedemocratica.org.br>` (Varia√ß√£o) **OU** `Empurrando Juntas <cd@cidadedemocratica.org.br> via pencillabss.tec.br` (Typosquatting) | Uso de endere√ßo de e-mail semelhante ou r√©plica, explorando a desaten√ß√£o do destinat√°rio. |
| **subject:** | **Sua Opini√£o √© Crucial - Vota√ß√£o Bloqueada Devido a Fraudes** | Cria senso de urg√™ncia e import√¢ncia, motivando o clique imediato. |
| **mailed-by/signed-by:** | Servidor de e-mail malicioso (Ex: `phish-server.com`) | Dif√≠cil de replicar a assinatura leg√≠tima, mas muitos usu√°rios n√£o verificam esses campos. |
| **Corpo da Mensagem:** | Simula√ß√£o de uma notifica√ß√£o de que a vota√ß√£o em andamento foi temporariamente suspensa e que, para desbloque√°-la e garantir a seguran√ßa do voto, √© necess√°rio que o usu√°rio **revalide** sua conta clicando no link abaixo e fornecendo suas credenciais. | Usa o vocabul√°rio da plataforma ("vota√ß√£o", "opini√£o") para aumentar a credibilidade e insere um **Call to Action (CTA)** urgente. |
| **Link (CTA):** | `https://empurrandajuntas.com/revalidacao/login-seguro` (URL falsa com *typosquatting* ou subdom√≠nio) | O link direciona para uma p√°gina de *login* falsa que imita a interface da plataforma "Empurrando Juntas". |

**2. Conte√∫do Simulador (Corpo do E-mail):**

> Prezado(a) Participante,
>
> Sua participa√ß√£o √© vital para a transpar√™ncia de nossas conversas e vota√ß√µes.
>
> Detectamos atividades suspeitas que indicam uma poss√≠vel tentativa de fraude em uma das vota√ß√µes que voc√™ est√° participando. Para proteger a integridade do processo e garantir que sua voz seja ouvida, fomos obrigados a suspender temporariamente sua conta e acesso a todas as vota√ß√µes.
>
> Para reativar sua participa√ß√£o e permitir a continuidade das discuss√µes, √© **obrigat√≥rio** que voc√™ revalide suas credenciais imediatamente no link seguro abaixo:
>
> [**Clique aqui para revalidar sua conta**](https://empurrandajuntas.com/revalidacao/login-seguro)
>
> *O n√£o cumprimento desta a√ß√£o em at√© 24 horas resultar√° na exclus√£o da sua participa√ß√£o nas vota√ß√µes em andamento.*
>
> Atenciosamente,
>
> Equipe de Seguran√ßa da Plataforma Empurrando Juntas.

**Obs:** A landing page (link) falsa em si n√£o foi criada, uma vez que isso transpassa a √©tica dessa simula√ß√£o. Logo, a url utilizada no email √© apenas um exemplo n√£o funcional.

**3. P√°gina de Destino (Landing Page Falsa):**

Ao clicar no link, o usu√°rio √© direcionado a uma p√°gina (hospedada pelo atacante) visualmente id√™ntica √† p√°gina de login oficial da plataforma. A p√°gina solicita o **Nome de Usu√°rio (ou Email)** e a **Senha**.

Ap√≥s o usu√°rio inserir as credenciais, a p√°gina falsa:

1.  **Captura os dados** (`usu√°rio` e `senha`) e os armazena no servidor do atacante.
2.  **Redireciona o usu√°rio** para a p√°gina inicial (ou de login) leg√≠tima da plataforma, exibindo uma mensagem de erro gen√©rica ("Sua sess√£o expirou, tente novamente"), para que a v√≠tima acredite que apenas digitou as credenciais incorretamente, sem suspeitar do roubo.

**Conclus√£o da Simula√ß√£o:**

A simula√ß√£o de *phishing* neste contexto explora o modelo de comunica√ß√£o por e-mail, a relev√¢ncia do tema (vota√ß√£o/opini√£o) e a urg√™ncia (*call to action* para desbloqueio de conta) para induzir a v√≠tima a fornecer suas credenciais. O roubo de credenciais permite ao atacante acesso total √† conta da v√≠tima, possibilitando manipula√ß√£o de votos, conversas e roubo de dados sens√≠veis.

---

## 5. Maiores Dificuldades

* Integra√ß√£o de ferramentas de seguran√ßa (Gitleaks, Bandit) no fluxo CI/CD existente.

---

## 6. Li√ß√µes Aprendidas

* Import√¢ncia da integra√ß√£o de ferramentas de seguran√ßa no ciclo de desenvolvimento.

---

## 7. Planejamento para a Pr√≥xima Sprint

### Blue Team

* Implementar ferramentas de seguran√ßa no pipeline CI/CD do projeto
* Configurar Gitleaks e Bandit no fluxo de integra√ß√£o cont√≠nua
* Desenvolver pol√≠ticas de seguran√ßa para c√≥digo e depend√™ncias
* Criar monitoramento cont√≠nuo de vulnerabilidades

### Red Team

* Ataque coordenado contra Blue Team:
    * Pipeline
* Documentar TTPs no formato MITRE ATT&CK
