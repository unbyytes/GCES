# üìù Relat√≥rio de Contribui√ß√£o ‚Äì Sprint 2

**Disciplina:** Gest√£o de Configura√ß√£o e Evolu√ß√£o de Software

**Equipe:** OWASP (Times Blue e Red)

**Per√≠odo da Sprint:** 24/09/2025 - 07/10/2025

---

## 1. Objetivos da Sprint

### Blue Team

* O B√°sico do CI/CD ‚Äì A Funda√ß√£o
    - Entender o GitLab CI/CD e criar um pipeline m√≠nimo que funcione.
    - O que √© CI/CD (Integra√ß√£o Cont√≠nua / Entrega Cont√≠nua)?
    - Como funciona o GitLab CI/CD?
    - O que s√£o "Runners", "Jobs", "Stages"
    - O que faz o arquivo .gitlab-ci.yml

### Red Team

- Explorar ataques sobre o EJ (Red Team): SQL Injection, CSRF, XSS e Clickjacking
- Estudar sobre:
    - IDOR
    - Sess√µes / Cookies inseguros
    - Brute force / Rate limiting

---

## 2. Entregas Coletivas

| Entrega                                                             | Status (Conclu√≠do/Parcial/Pendente) | Link/Refer√™ncia        | Observa√ß√µes                       |
| ------------------------------------------------------------------- | ----------------------------------- | ---------------------- | --------------------------------- |
| An√°lise da Plataforma sobre SQL Injection, XSS, CSRF e Clickjacking | Conclu√≠do                           |                        |                                   |

---

## 3. Contribui√ß√µes Individuais

| Integrante        | Contribui√ß√µes                             | Links (PRs, Issues, Docs) | Observa√ß√µes |
| ----------------- | ----------------------------------------- | ------------------------- | ----------- |
| Mateus Vieira     | Documenta√ß√£o de Vulnerabilidade XSS V1.0  | [An√°lise sobre XSS (Vulnerabilidade Encontrada)](#an√°lise-sobre-xss-vulnerabilidade-encontrada)               |             |
| Breno Lucena      | Estudo sobre CI/CD em pipelines no GitLab | [Estudo e Pr√°tica ‚Äî CI/CD com GitLab](https://unbyytes.github.io/GCES/estudo/ci-cd/)  |             |
| J√∫lio Costa      | Documenta√ß√£o e Pr√°tica do Ataque de SQL Injection | [Ataque SQL Injection](#ataque-sobre-sql-injection)  |             |
| Henrique Hida      | Documenta√ß√£o e Pr√°tica do Ataque de CSRF | [Ataque CSRF](#ataque-sobre-csrf)  |             |
| Marcus Vinicius   | Documenta√ß√£o e Pr√°tica de Ataques de IDOR e An√°lise de Cookies | [An√°lise IDOR e Cookies](#ataque-sobre-idor-insecure-direct-object-reference) |          |

---

## 4. Maiores Avan√ßos

### Red Team

#### Ataque sobre SQL Injection

Foi utilizado a ferramenta [BurpSuite Community Edition](https://portswigger.net/burp) para a obten√ß√£o das URLs de requisi√ß√µes GET e POST, na aba *Proxy/Intercept*, clicando na op√ß√£o de abrir Browser, que ir√° abrir um browser Chromium normal, a partir dele entrei na conta fake de testes como usu√°rio (user@user.com) presente no banco de dados postgres atrav√©s do comando `inv docker-exec 'inv db-fake'` e realizei a√ß√µes comuns do usu√°rio como criar um dashboard, personas, alterar informa√ß√µes do usu√°rio logado, etc.

O [BurpSuite](https://portswigger.net/burp) manteve um hist√≥rico de todas as requisi√ß√µes feitas nesta sess√£o na aba *Proxy/HTTP History*, foi selecionado todas as requisi√ß√µes desse hist√≥rico e salvo em um arquivo xml que ser√° passado como argumento para o [SQLMap](https://sqlmap.org/)

Para o teste de fato foi utilizado a ferramenta [SQLMap](https://sqlmap.org/), muito utilizada para ataques de SQL Injection com muitas op√ß√µes avan√ßadas e suporte a v√°rios banco de dados (Oracle, Postgres, MySQL, etc), foi executado o seguinte comando:

`sqlmap -l burg_log.xml --batch --level 5 --risk 3 --dbms postgres`

- `-l`: Comando especifico para obter alvos atrav√©s de um arquivo log do BurpSuite ou WebScarab
- `burg_log.xml`: Arquivo de log obtido atrav√©s do Proxy do BurpSuite
- `--batch`: N√£o perguntar por confirma√ß√µes e selecionar as op√ß√µes padr√µes
- `--level 5`: N√≠vel m√°ximo de quantidade de testes a serem realizados
- `--risk 3`: N√≠vel de risco m√°ximo, com alta chance de ser detectado (n√£o √© importante neste caso)
- `--dbms postgres`: Informa o SQLMap para usar apenas scripts especificos para postgres, usado na EJ Application, se n√£o informado o [SQLMap](https://sqlmap.org/) ir√° tentar scripts de v√°rios banco de dados diferentes como Oracle, MySQL e outros.

N√£o foram encontrados pontos de falha SQL Injection utilizando [SQLMap](https://sqlmap.org/), apesar de ele ter encontrado alguns falsos positivos: 

- Em localhost/boards/teste/conversations/add/ usando SQL Injection no User-Agent com t√©cnicas boolean blind based
- Em localhost/boards/teste/conversations usando SQL Injection no Cookie de sessionid com t√©cnicas boolean blind based

Esses falsos positivos foram identificados com a t√©cnica de boolean blind based que injeta scripts SQL em objetos dentro da requisi√ß√£o e espera uma resposta diferente da padr√£o, se houve uma resposta diferente ent√£o o ataque √© considerado bem sucedido, mas isso pode ocorrer quando uma p√°gina possu√≠ elementos din√¢micos, provavelmente o [SQLMap](https://sqlmap.org/) verificou que a p√°gina mudou, mas ao tentar fazer um exploit (acesso ao banco de dados ou obter informa√ß√µes) atrav√©s desta t√©cnica ele n√£o teve resultados.

```
Target URL,Place,Parameter,Technique(s),Note(s)
http://10.0.0.5:8000/boards/teste/conversations/,Cookie,sessionid,B,false positive or unexploitable
http://10.0.0.5:8000/boards/teste/conversations/add/,User-Agent,User-Agent,B,false positive or unexploitable
```

V√≠deo de demonstra√ß√£o: 
<iframe width="1310" height="737" src="https://www.youtube.com/embed/QMBZJynQwfU" title="EJ Application Teste SQL Injection" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

#### Ataque sobre XSS (Vulnerabilidade Encontrada)

* **Tipo de vulnerabilidade:** XSS Persistente (Stored XSS).
* **Localiza√ß√£o:** Campos Rich Text. O conte√∫do salvo √© posteriormente renderizado no navegador sem escaping adequado.
* **Causa raiz:** Falta de sanitiza√ß√£o no backend + renderiza√ß√£o com flags que desabilitam escaping, permitindo que conte√∫do armazenado seja interpretado como c√≥digo no cliente.
* **Evid√™ncia:** Conte√∫do malicioso foi persistido no banco e provoca execu√ß√£o de script quando a p√°gina afetada √© carregada por um usu√°rio. (passos e payloads foram removidos deste documento).
* **Impacto potencial:** Roubo de cookies de sess√£o, execu√ß√£o de a√ß√µes em nome do usu√°rio, manipula√ß√£o de feedbacks/entradas, redirecionamentos e degrada√ß√£o da confian√ßa na plataforma.
* **Recomenda√ß√µes:**
    * Implementar sanitiza√ß√£o server-side robusta para entradas Rich Text (usar bibliotecas maduras e listas de permiss√£o de tags/atributos).
    * Evitar uso irrestrito de flags que desabilitem escaping; garantir que qualquer conte√∫do marcado como seguro seja validado e sanitizado.

Link: [Relat√≥rio Completo de Reprodu√ß√£o e An√°lise da Vulnerabilidade](https://unbbr-my.sharepoint.com/:b:/g/personal/221008703_aluno_unb_br/ESkTAolLP5ZHqdUQFBZEjyAB9DxryON9Fn3o2vW0_7rRzA)

**Obs:** O relat√≥rio completo √© um arquivo privado no OneDrive e, at√© o momento, s√≥ est√° liberado para a professora da disciplina.

#### Ataque sobre CSRF
**O que √© CSRF (Cross-Site Request Forgery)**

CSRF √© uma t√©cnica de ataque em que um site malicioso faz com que o **navegador de uma v√≠tima autenticada** envie requisi√ß√µes indesejadas a um site confi√°vel onde a v√≠tima j√° possui sess√£o ativa. O atacante explora o fato de que **cookies e outras credenciais gerenciadas automaticamente pelo navegador** s√£o inclu√≠das em requisi√ß√µes originadas do contexto do usu√°rio.

**Cen√°rio de teste descrito**

1. **Testar via p√°gina HTML separada** ‚Äî Foi criado um arquivo HTML que tenta enviar um POST para `http://localhost:8000/api/v1/votes/` a partir do mesmo navegador onde est√° logado como admin. Ao submeter a requisi√ß√£o pelo HTML, o servidor respondeu com `401 Unauthorized` e o JSON `{"detail": "Credenciais de autentica√ß√£o n√£o foram fornecidas."}`.

**Sa√≠da observada**

```
Vote List
POST /api/v1/votes/
HTTP 401 Unauthorized
Allow: GET, POST, HEAD, OPTIONS
Content-Type: application/json
Vary: Accept
WWW-Authenticate: Bearer realm="api"

{
    "detail": "Credenciais de autentica√ß√£o n√£o foram fornecidas."
}
```

- O comportamento indica que o endpoint **exige um header `Authorization: Bearer <token>`** para autentica√ß√£o, ou outro esquema que n√£o √© enviado automaticamente pelo navegador quando a requisi√ß√£o √© iniciada de outro site.
- Quando a requisi√ß√£o foi disparada a partir do HTML externo, **o navegador n√£o enviou qualquer credencial** (nem cookie de sess√£o nem header Authorization), logo o servidor respondeu `401`.
- Isso **implica** que o mecanismo de autentica√ß√£o atual **n√£o √© baseado em cookies de sess√£o enviados automaticamente**. Como resultado, o vetor cl√°ssico de CSRF **falhou**.

#### Ataque sobre Clickjacking

* **Tipo de vulnerabilidade:** Clickjacking (UI Redress Attack).  
* **Localiza√ß√£o:** P√°ginas p√∫blicas e autenticadas da aplica√ß√£o EJ (testes realizados no endpoint `/login` e em outras rotas acess√≠veis sem prote√ß√£o de cabe√ßalhos).  
* **Causa raiz:** Aus√™ncia dos cabe√ßalhos de seguran√ßa `X-Frame-Options` e `Content-Security-Policy: frame-ancestors`, o que permite que a aplica√ß√£o seja embutida dentro de um `<iframe>` externo.  
* **Descri√ß√£o do ataque:**  
  O atacante pode criar uma p√°gina maliciosa contendo um `iframe` invis√≠vel ou semitransparente que carrega a aplica√ß√£o leg√≠tima. Sobre este `iframe`, ele posiciona elementos visuais falsos (ex.: ‚ÄúClique aqui para ganhar um pr√™mio‚Äù). Quando o usu√°rio clica nesses elementos, o clique √© redirecionado para o bot√£o real da aplica√ß√£o ‚Äî por exemplo, um bot√£o de login, confirma√ß√£o ou envio ‚Äî sem o conhecimento do usu√°rio.  

* **Prova de Conceito (PoC):**  
  Foi criado o arquivo `poc.html` contendo um iframe apontando para a p√°gina de login da EJ Application:

### **Ataque sobre IDOR (Insecure Direct Object Reference)**

#### O que √© IDOR?

*IDOR (Insecure Direct Object Reference)* √© uma falha de controle de acesso onde um *site permite que um usu√°rio acesse ou modifique dados que n√£o pertencem a ele*, simplesmente ao manipular o valor de um identificador (ID) em uma requisi√ß√£o, como um n√∫mero na URL. Se a aplica√ß√£o n√£o verificar se o usu√°rio logado tem permiss√£o para acessar o objeto com aquele ID, a vulnerabilidade existe.

#### Cen√°rio de teste descrito

1.  **Prepara√ß√£o** ‚Äî Foi feito o login como `admin@admin.com` para acessar o painel de administra√ß√£o (`/admin/`) e descobrir o ID num√©rico de usu√°rios.
2.  **Teste** ‚Äî Em um navegador separado (janela an√¥nima), foi feito o login como um usu√°rio comum (`user@user.com`). Em seguida, foi feita uma tentativa de acesso direto ao perfil do admin, for√ßando a URL para `http://localhost:8000/users/34/`.
3.  **Resultado** ‚Äî O servidor respondeu com um erro **`404 Page not found`**.

#### Sa√≠da observada

A aplica√ß√£o retornou a p√°gina de erro padr√£o do Django, indicando que a rota solicitada n√£o existe. A lista de URLs v√°lidas exibida na p√°gina de erro confirmou que n√£o h√° um padr√£o de URL no formato `/users/<ID>/`.

* E esse comportamento indica que a aplica√ß√£o n√£o exp√µe perfis de usu√°rio atrav√©s de uma URL direta com o ID num√©rico.
* Como a rota n√£o existe, o resultado pr√°tico √© que este vetor de ataque espec√≠fico de IDOR n√£o √© explor√°vel.

### **Ataque sobre Sess√µes / Cookies Inseguros**

#### O que s√£o Sess√µes / Cookies Inseguros?

Refere-se a falhas no gerenciamento do cookie que identifica a sess√£o de um usu√°rio logado. Se o cookie n√£o for configurado com atributos de seguran√ßa (flags), ele pode ser interceptado em redes inseguras ou roubado por scripts maliciosos.

#### Cen√°rio de teste descrito

1.  **Prepara√ß√£o** ‚Äî Foi feito o login na aplica√ß√£o com um usu√°rio.
2.  **Teste** ‚Äî Utilizando as Ferramentas de Desenvolvedor do navegador (`F12`), a aba `Application` (ou `Storage`) foi usada para inspecionar os cookies do site.
3.  **Resultado** ‚Äî O cookie `sessionid` foi localizado e seus atributos de seguran√ßa foram analisados.

#### Sa√≠da observada

A inspe√ß√£o do cookie `sessionid` revelou os seguintes atributos:
* **`HttpOnly`**: `True`
* **`Secure`**: `False`
* **`SameSite`**: `Lax`

* O comportamento indica que o cookie de sess√£o est√° corretamente protegido contra leitura por scripts JavaScript (gra√ßas √† flag **`HttpOnly`**).
* A flag **`SameSite=Lax`** tamb√©m √© uma boa configura√ß√£o padr√£o, oferecendo prote√ß√£o contra ataques de CSRF.
* No entanto, a flag **`Secure`** est√° ausente. Isso implica que, em um ambiente de produ√ß√£o real com HTTPS, o cookie poderia ser interceptado, representando uma vulnerabilidade.

---

## 5. Maiores Dificuldades

* Houve dificuldade de acesso √† aplica√ß√£o Docker via Kali Linux, resolvida ao incluir o IP local da m√°quina host em `DJANGO_ALLOWED_HOSTS`.
* Houve dificuldade em gerenciar duas sess√µes simult√¢neas para testes de IDOR (foi necess√°rio usar navegadores/perfis distintos).
* Houve dificuldade em contornar a sanitiza√ß√£o de entradas da API para explorar vulnerabilidades XSS, pois os endpoints estavam bem protegidos, tornando complexo identificar pontos suscet√≠veis a ataques.

---

## 6. Li√ß√µes Aprendidas

* Utiliza√ß√£o de sqlmap e BurpSuite para testes de inje√ß√£o e proxy de requisi√ß√µes.
* Sanitiza√ß√£o server-side √© obrigat√≥ria, mesmo com valida√ß√µes client-side.
* Rich Text com renderiza√ß√£o sem escape aumenta risco de XSS persistente.
* Ferramentas automatizadas (ex.: sqlmap) ajudam na triagem; an√°lise manual ainda √© necess√°ria.

---

## 7. Planejamento para a Pr√≥xima Sprint

### Blue Team

### Red Team

* Explorar Ataques:
    * IDOR
    * Sess√£o (Cookies)
    * Rate-limit / Fuzzing
* Simular phishing no contexto da plataforma
